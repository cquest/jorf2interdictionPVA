import re
import sys

ocr = open(sys.argv[1], 'r')
ok = 0
ok2 = 0

for ligne in ocr:
    l = re.sub('\n', '', ligne)
    if re.match('olygone', l):
        last = '@'
    if re.search('[0-9].* [0-9].* [0-9]', l) or re.search('[0-9]°[0-9]', l):
        # substitution globales
        l = re.sub('([0-9])[OQ]', '\g<1>0', l)
        l = re.sub('[OQ]([0-9])', '0\g<1>', l)
        l = re.sub('’', '\'', l)
        l = re.sub('”', '"', l)
        l = re.sub('\*', ' ', l)
        l = re.sub(' +', ' ', l)

        # partie initiale
        l = re.sub('^À','A',l)
        l = re.sub('^€','C',l)
        l = re.sub('^1:','I:',l)
        l = re.sub('(^[A-Z]?\'?) ','\g<1>',l)
        l = re.sub('(^[A-Z]?\'?)\.','\g<1>:',l)
        l = re.sub('(^[A-Z]?\'?:)([^ ])','\g<1> \g<2>',l)
        l = re.sub('(^[0-9]{1,3}°)',': \g<1>',l)
        if l[0]==':':
            l = chr(ord(last[0])+1) + l

        l = re.sub('(^[A-Z]?\'?: [0-9]{1,3})[^°]? ','\g<1>° ',l)
        l = re.sub('(^[A-Z]?\'?: [0-9]{1,3}°)([^ ])','\g<1> \g<2>',l)
        l = re.sub('°([^ ])','° \g<1>',l)

        l = re.sub('(^[A-Z]?\'?: [0-9]{1,3}° [0-9][0-9])([0-9][0-9])','\g<1>\' \g<2>',l)
        l = re.sub('(^[A-Z]?\'?: [0-9]{1,3}° [0-9]{1,2})[^\']? ','\g<1>\' ',l)
        l = re.sub('(^[A-Z]?\'?: [0-9]{1,3}° [0-9]{1,2}\')([^ ])','\g<1> \g<2>',l)

        l = re.sub('(^[A-Z]?\'?: [0-9]{1,3}° [0-9]{1,2}\' [0-9]+)\.','\g<1>,',l)
        l = re.sub('(^[A-Z]?\'?: [0-9]{1,3}° [0-9]{1,2}\' [0-9,]+)[^"]? ','\g<1>" ',l)
        l = re.sub('(^[A-Z]?\'?: [0-9]{1,3}° [0-9]{1,2}\' [0-9,]+")([^ ])','\g<1> \g<2>',l)

        l = re.sub('(^[A-Z]?\'?: [0-9]{1,3}° [0-9]{1,2}\' [0-9,]+" )[0OQ©]+','\g<1>O',l)
        l = re.sub('" "','"',l)
        l = re.sub('(^[A-Z]?\'?: [0-9]{1,3}° [0-9]{1,2}\' [0-9,]+")E','\g<1> E',l)

        l = re.sub('(^[A-Z]?\'?: [1][0-9]{2}° [0-9]{1,2}\' [0-9,]+") [^EO]','\g<1> O',l)
        l = re.sub('(^[A-Z]?\'?: [0-9]{1,3}° [0-9]{1,2}\' [0-9,]+" [EO] / [12][0-9]° [0-9]{1,2}\' [0-9,]+")$','\g<1> S',l)

        l = re.sub('(^[A-Z]?\'?: [0-9]{1,3}° [0-9]{1,2}\' [0-9,]+" [EO])([^ ])','\g<1> \g<2>',l)
        l = re.sub('(^[A-Z]?\'?: [0-9]{1,3}° [0-9]{1,2}\' [0-9,]+" [EO] )[\{7j41]','\g<1>/',l)
        l = re.sub('(^[A-Z]?\'?: [0-9]{1,3}° [0-9]{1,2}\' [0-9,]+" [EO] /)([^ ])','\g<1> \g<2>',l)
        l = re.sub('/ /','/',l)
        l = re.sub('(^[A-Z]?\'?: [0-9]{1,3}° [0-9]{1,2}\' [0-9,]+" [EO]).* /','\g<1> / ',l)
        l = re.sub(' +',' ',l)

        l = re.sub('(^[A-Z]?\'?: [0-9]{1,3}° [0-9]{1,2}\' [0-9,]+" [EO] / [0-9]{1,3})[^°]? ','\g<1>° ',l)
        l = re.sub('(^[A-Z]?\'?: [0-9]{1,3}° [0-9]{1,2}\' [0-9,]+" [EO] / [0-9]{1,3}°)([^ ])','\g<1> \g<2>',l)
        l = re.sub('(^[A-Z]?\'?: [0-9]{1,3}° [0-9]{1,2}\' [0-9,]+" [EO] / [0-9]{1,3}° [0-9]{1,2})[^\']? ','\g<1>\' ',l)
        l = re.sub('(^[A-Z]?\'?: [0-9]{1,3}° [0-9]{1,2}\' [0-9,]+" [EO] / [0-9]{1,3}° [0-9][0-9])([0-9][0-9])','\g<1>\' \g<2>',l)
        l = re.sub('(^[A-Z]?\'?: [0-9]{1,3}° [0-9]{1,2}\' [0-9,]+" [EO] / [0-9]{1,3}° [0-9]{1,2}\')([^ ])','\g<1> \g<2>',l)

        l = re.sub('(^[A-Z]?\'?: [0-9]{1,3}° [0-9]{1,2}\' [0-9,]+" [EO] / [0-9]{1,3}° [0-9]{1,2}\' [0-9][0-9])([0-9]+)','\g<1>,\g<2>',l)
        l = re.sub('(^[A-Z]?\'?: [0-9]{1,3}° [0-9]{1,2}\' [0-9,]+" [EO] / [0-9]{1,3}° [0-9]{1,2}\' [0-9]+)\.','\g<1>,',l)
        l = re.sub('(^[A-Z]?\'?: [0-9]{1,3}° [0-9]{1,2}\' [0-9,]+" [EO] / [0-9]{1,3}° [0-9]{1,2}\' [0-9,]+)[^"]?[NS ]','\g<1>"',l+' ').strip()

        l = re.sub('(^[A-Z]?\'?: [0-9]{1,3}° [0-9]{1,2}\' [0-9,]+" [EO] / [0-9]{1,3}° [0-9]{1,2}\' [0-9,]+").*([NS])','\g<1> \g<2>',l)

        l = re.sub('(^[A-Z]?\'?: [0-9]{1,3}° [0-9]{1,2}\' [0-9,]+" [EO] / [45][0-9]° [0-9]{1,2}\' [0-9,]+")$','\g<1> N',l)
        l = re.sub('(^[A-Z]?\'?: [0-9]{1,3}° [0-9]{1,2}\' [0-9,]+" [EO] / [12][0-9]° [0-9]{1,2}\' [0-9,]+")$','\g<1> S',l)

        l = re.sub('( [0-9]{1,2}\') ([0-9,]+)[°\*]', '\g<1> \g<2>"', l)

        #m = re.match('^[A-Z]?\'?: [0-9]{1,3}° [0-9]*\' [0-9,]+" [EO] / [0-9]{1,3}° [0-9]{1,2}\' ',l)
        #if not m and re.match( '^[A-Z]?\'?: [0-9]{1,3}° [0-9]*\' [0-9,]+" [EO] / ',l):
        #    print(re.sub('\n','',ligne),' >-> ',l)

        if re.match(r'^([A-Z])?: ([0-9]{1,3})° ([0-5]?[0-9])\' ([0-5]?[0-9](,[0-9]{1,3})?)" ([EO]) / ([0-9]{1,3})° ([0-5]?[0-9])\' ([0-5]?[0-9](,[0-9]{1,3})?)" ([NS])( (.*)km)?$',l):
            #print('OK',re.sub('\n','',ligne),' >-> ',l)
            ok = ok + 1
            print(l)
        else:
            print("ERR",l)
        last = l
    else:
        print(l)

print()
#print(ok,ok2)
